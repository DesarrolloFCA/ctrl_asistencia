<?php

/**
 * Created by IntelliJ IDEA.
 * User: ablanco
 * Date: 18/06/15
 * Time: 17:14.
 */
namespace SIU\AraiCli\Commands\Registry;

use SIU\AraiCli\Factory;
use SIU\AraiCli\Commands\BaseCommand;
use SIU\AraiCli\Services\Registry\AraiJsonUtil;
use SIU\AraiCli\Services\Registry\Registry;
use SIU\AraiCli\Services\Registry\RegistryException;
use SIU\AraiJsonParser\AraiPackage;
use Symfony\Component\Console\Input\InputInterface;
use Symfony\Component\Console\Output\OutputInterface;

class Status extends BaseCommand
{
    protected function configure()
    {
        $this
            ->setName('registry:status')
            ->setDescription('Se muestra información del estado de la aplicación en ARAI-Registry')
        ;
    }

    protected function execute(InputInterface $input, OutputInterface $output)
    {
        $c = Factory::getContainer();
        /** @var Registry $server */
        $server = $c['arai-registry'];

        $status = $server->getStatus();

        if (!$status['registrada']) {
            $this->getIO()->write('<info>Esta aplicación no se encuentra registrada en ARAI-Registry.</info>');
            return;
        }

        $this->getIO()->write("Url ARAI-Registry:\t<info>{$status['url']}</info>");
        $this->getIO()->write("Nombre de instancia:\t<info>{$status['nombre-instancia']}</info>");
        $lastSync = date('d/m/Y \a \l\a\s H:i:s', strtotime($status['ultima-actualizacion']));
        $this->getIO()->write("Última actualización:\t<info>$lastSync</info>");
    }
}
