<?php
/**
 * Created by IntelliJ IDEA.
 * User: fbohn
 * Date: 28/03/16
 * Time: 16:40
 */

use SIU\AraiJsonMigrator\AraiMigratorManager;
use SIU\AraiJsonMigrator\AraiMigrator;

class AraiMigratorManagerTest extends PHPUnit_Framework_TestCase
{

    public function testLoadFromFile()
    {
        $manager = new AraiMigratorManager();
        /* @var AraiMigrator $data */
        $data = $manager->load(__DIR__.'/fixtures/migration-minimal-correct.json');
        $this->assertTrue($data->getName() === "migrationMapuche");
        $this->assertTrue($data->getDescription() === "Migracion de usuarios de Mapuche");
        $this->assertTrue($data->getMantainer() === "pepe");
        $this->assertTrue($data->getMantainerEmail() === "pepe@mail.com");
        $this->assertTrue(count($data->getPeopleList()) === 0);
        $this->assertTrue(count($data->getAccountsList()) === 0);
    }

    public function testComplexJsonLoad()
    {
        $manager = new AraiMigratorManager();
        /* @var AraiMigrator $data */
        $data = $manager->load(__DIR__.'/fixtures/migration-correct.json');
        $this->assertTrue($data->getName() === "migrationMapuche");
        $this->assertTrue($data->getDescription() === "Migracion de usuarios de Mapuche");
        $this->assertTrue($data->getMantainer() === "pepe");
        $this->assertTrue($data->getMantainerEmail() === "pepe@mail.com");
        $this->assertTrue(count($data->getPeopleList()) === 3);
        $this->assertTrue(count($data->getAccountsList()) === 3);
    }

    public function testEncodeJson()
    {
        $manager = new AraiMigratorManager();
        /* @var AraiMigrator $data */
        $data = $manager->load(__DIR__.'/fixtures/migration-correct.json');
        $jsonString = $manager->encodeJson($data);
        
        $this->assertJsonStringEqualsJsonFile(__DIR__.'/fixtures/migration-correct.json', $jsonString);
    }

    public function testSave()
    {
        $manager = new AraiMigratorManager();

        /* @var AraiMigrator $data */
        $data = $manager->load(__DIR__.'/fixtures/migration-correct.json');
        $jsonString = $manager->encodeJson($data);

        $manager->save(__DIR__.'/fixtures/temp/migration-correct-save.json', $data);

        /* @var AraiMigrator $dataSave */
        $dataSave = $manager->load(__DIR__.'/fixtures/temp/migration-correct-save.json');
        $jsonStringSave = $manager->encodeJson($dataSave);


        $this->assertJsonStringEqualsJsonString($jsonString, $jsonStringSave);
    }


}
